# 血染钟楼 Blood on the ClockTower 

> 血染钟楼桌游线下辅助器

**亮点**：
+ 取代说书人角色，所有线下小伙伴都可以深度参与解谜
+ 全程无需闭眼，不会有长时间的闭目养神和睁眼闭眼过程
+ 全程无倒计时，玩家们可以自由控制各阶段时长
+ 无需按序施放技能，玩家们可同时在某夜或某日释放技能
+ 操作简单，所有操作最多只需点3下，例如施放技能：选人 → 点技能按钮(每人只有一个) → 点确定
+ 丰富明确的提示，解开大部分对于是否可操作的疑惑，减少解答时间
+ 多彩高亮的日志，帮助玩家记录
+ 防场外，即便晚上没技能，也需要操作手机；隐藏身份信息等

**不足**：
+ 目前只支持《血染钟楼：灾祸滋生》版本
+ 不提供说书人角色，就想当主持人的小伙伴不好意思了
+ 防场外不是绝对的，不过也可以利用场外来掩盖真相，比如故意操作很长时间

## 1. 说明书
### 1.1 游戏概述

> 具体技能见正版游戏说明书，和1.3节（技能细节）

+ 游戏版本：灾祸滋生
+ 阵营与角色
    + 村民（平民阵营）
        + 洗衣妇
        + 图书管理员
        + 调查员
        + 厨师
        + 共情者
        + 占卜师
        + 掘墓人
        + 僧侣
        + 守鸦人
        + 圣女
        + 杀手
        + 士兵
        + 市长
    + 外来者（平民阵营）
        + 管家
        + 酒鬼
        + 隐士
        + 圣徒
    + 爪牙（邪恶阵营）
        + 下毒者
        + 间谍
        + 魅魔
        + 男爵
    + 恶魔（邪恶阵营）
        + 小恶魔
+ 胜利条件
    + 平民：
        1. 恶魔被铲除
        2. 白天剩三人，其中一个是市长，且当日无人被处决
    + 邪恶
        1. 场上没人可以提名，且没有杀手或有杀手没有子弹
        2. 可投的票数不大于活人的半数，且存活的邪恶玩家数量不小于活人的半数，且没有杀手或有杀手没有子弹
        3. 平民阵营被屠城
        4. 圣徒被投票处决

### 1.2 游戏流程（结合辅助器）

> 全程无需闭眼，给别人看屏幕算场外

初始状态
[图片]
点击右上角日夜切换按钮进入第一夜
[图片]
选择玩家，发动技能
[图片]
点击右上角日夜切换按钮进入白天
[图片]
点击玩家，发动提名
[图片]
点击右上角结束投票按钮，结算投票结果
[图片]
如果没有人被处决，则还可以提名
[图片]
大家都同意进入夜晚，则点击日夜切换按钮
[图片]
游戏结束后，进入复盘页面
[图片]

### 1.3 技能细节
+ 洗衣妇
    + 被毒后，有极小概率获取真实信息
+ 图书管理员
    + 被毒后，有极小概率获取真实信息
    + 被毒后，也有极小概率获取“没有外来者”
+ 调查员
    + 被毒后，有极小概率获取真实信息
+ 厨师
    + 一对是两恶相连，两对是三恶连座
+ 共情者
    + 邻座不算死人
+ 占卜师
    + 只会提示有和没有，不会提供数量
    + 隐士被视作恶魔，占卜会读到“有”
    + 有一个玩家会在开局前就设定好被占卜视为的恶魔身份不会变，除非他是隐士被毒
+ 掘墓人
    + 挖到隐士，会看到他被当作的身份，而不是隐士；如果隐士中毒，看到的是隐士
    + 隐士被处决，下毒再毒，挖出来是隐士身份，而不是被当作的身份
+ 僧侣
    + 不能守自己
    + 僧侣守护可挡刀挡毒
+ 守鸦人
    + 守鸦人需要在每晚（除第一夜）验人（程序需要），可以每晚假定死的是自己，则要验谁
    + 转天自己没死，则没有信息
    + 可以验死人
    + 验到隐士，会看到他被当作的身份，而不是隐士；如果隐士中毒，看到的是隐士
+ 圣女
    + 村民提名立即触发技能
    + 被毒，也会消耗技能，但不会有人被弹死
+ 杀手
    + 白天开枪，立即结算
    + 枪毙被当作恶魔的隐士，隐士直接死亡
    + 被枪毙者不暴露身份
+ 士兵
    + 可与守护叠加
+ 市长
    + 可达成平民胜利条件二
+ 管家
    + 主人投票，他可选投
    + 主人不投票，他票作废，会再结算投票时把票补回来
    + 管家不能认主死人
+ 酒鬼
    + 开局获取身份，自己并不知道自己是酒鬼
+ 隐士
    + 开局被当作的邪恶身份，爪牙或恶魔
    + 被毒会变回隐士
+ 圣徒
    + 可达成邪恶胜利条件四
+ 下毒者
    + 毒隐士会让隐士不再邪恶，如果隐士被视作恶魔，被毒也不再被视作恶魔
    + 毒间谍会让间谍变为邪恶
    + 毒只在当晚和接下来的白天起作用
+ 魅魔
    + 恶魔自刀，优先变恶魔
    + 恶魔被处决后，活人数量依然大于等于5，转变为恶魔
+ 男爵
    + 开局技能生效
+ 间谍
    + 第一夜可获取所有身份，身份绝对正确，获取身份不受毒的影响
    + 被毒会变为邪恶
    + 恶魔可以直接知道间谍的身份，而不是只知道他是爪牙
+ 小恶魔
    + 被毒就是平安夜
    + 有一定概率直接刀死市长，市长会有概率转移弹死除恶魔外的一切活人
    + 自刀，有魅魔，魅魔先变小恶魔，没魅魔，随机一个变




## 2. 需求与设计

页面
----功能 API
--------输入输出

+ 房间列表页 √
    + 加载房间列表 /home 
        + 输入：无
        + 输出：roomList
    + 创建房间 /createRoom 
        + 功能：创建的房间的state赋值
        + 输入：无
        + 输出：无
    + 加入房间 /joinRoom/:roomId/:roomPassword 
        + 功能：验证密码；当前用户重连；新玩家加入
        + 输入：player{id, name}
        + 输出：无
+ 等待开始页 √
    + 加载房间 /room/:roomId
        + 输入：无
        + 输出：room
    + 退出房间 /quitRoom/:roomId
        + 功能：房间减少当前玩家，如果房间人数为0，则销毁房间；
        + 输入：player{id}
        + 输出：无
    + 开始游戏 /startGame/:roomId
        + 功能：改变房间state
        + 输入：无
        + 输出："ok" or null
+ 游戏中页
    + 加载游戏 /game/:roomId
        + 功能：根据人数，分配身份；夜晚读秒
        + 输入：无
        + 输出：game
    + 游戏过程 /gaming/:roomId/:playerId
        + 输入：action字符串
        + 输出：操作结果日志
+ 游戏结算页
    + 加载结算 /review/:roomId
        + 输入：无
        + 输出：无
    + 返回房间 /returnRoom/:roomId/:playerId
        + 输入：无
        + 输出：game
+ 其他功能
    + 房间15分钟没有开始，自动销毁
    + 等待开始时，断线重连 √
    + 游戏中时，断线重连


## 3. 日志设计

### 日志分类
+ 总日志：记录全部
+ 个人日志：记录自己可见的事件

### 事件分类
+ 公共事件（透明底，白字）
    + 重大事件
        + 样式：红字加粗
        + 词语：死亡|处决结果|提名|投票|平安夜
    + 玩家名字
        + 样式：黄底，黑字
        + 词语：[]包裹
    + 数字
        + 样式：紫色
        + 词语：第1夜
+ 私有事件
    + 个人技能
        + 样式：蓝字
        + 词语：下毒|占卜|认主|守护|杀害|枪毙|弹
    + 技能结果
        + 样式：绿底黑字
        + 词语：{}包裹


## 4. 游戏流程设计

+ 阶段 stage：夜晚和白天各为一个阶段
+ 环节 step：行为互斥
    + 技能施放环节：夜晚发动技能的角色在此环节施放技能
    + 自由发言环节：白天发动技能的角色在此环节施放技能，此环节可提名
    + 投票处决环节：此环节可投票

### 第一夜
1. 下毒 操作
2. 洗衣妇 日志
3. 图书管理员 日志
4. 调查员 日志
5. 厨师 日志
6. 共情者 日志
7. 占卜师 操作
8. 管家 操作
9. 间谍 日志

### 其他夜晚
1. 下毒 操作
2. 僧侣 操作
3. 魅魔 日志
4. 小恶魔 操作
5. 守鸦人 日志
6. 共情者 日志
7. 占卜师 操作
8. 管家 操作
9. 掘墓人 日志

### 白天
1. 圣女 日志
2. 杀手 操作
3. 士兵 日志
4. 市长 日志
5. 圣徒 日志


## 5. 功能测试

职业技能与处决，交互测试清单：
+ ~~小恶魔~~ 
    + ~~击杀~~
    + ~~刀士兵~~
    + ~~刀僧侣守护的人~~
    + ~~刀市长~~
    + ~~无魅魔自刀~~
    + ~~无魅魔，存活大于等于5人，被处决~~
    + ~~无魅魔，存活小于5人，被处决~~
+ 魅魔
    + 小恶魔自刀
    + 存活大于等于5人，小恶魔被处决
    + 存活小于5人，小恶魔被处决
+ ~~男爵~~
    + ~~少两个村民，多两个外来者~~
+ ~~间谍~~
    + ~~非邪恶玩家~~
    + ~~知晓所有身份~~
    + ~~屠城胜利条件~~
+ 下毒者
    + ~~毒小恶魔~~
    + 毒魅魔
    + 毒间谍
    + 毒圣徒
    + 毒隐士
    + 毒管家
    + 毒市长
    + 毒士兵
    + 毒杀手
    + ~~毒圣女~~
    + 毒守鸦人
    + ~~毒僧侣~~
    + 毒掘墓人
    + ~~毒占卜师~~
    + 毒共情者
    + 毒厨师
    + 毒调查员
    + 毒图书管理员
    + 毒洗衣妇
+ 圣徒
    + 胜利条件
+ ~~隐士~~
    + ~~初始化身份~~
+ ~~酒鬼~~
    + ~~初始化身份~~
+ 管家
    + ~~认主~~
    + 主人投票，他可选投
    + 主人不投，他投了也不算
+ ~~市长~~
    + ~~胜利条件2~~
+ ~~士兵~~
    + ~~被刀~~
+ ~~圣女~~
    + ~~弹~~
+ 守鸦人
    + 被刀验人
    + 看隐士看他被视作的身份
    + 守鸦人可选死人
+ 掘墓人
    + 无人处决
    + 验被处决人的身份
    + 挖隐士看他被视作的身份
+ ~~占卜师~~
    + ~~初始化恶魔~~
    + ~~选2人占卜~~
+ 共情者
    + 隐士邻座
+ 厨师
    + 连座
+ ~~调查员~~
+ ~~图书管理员~~
+ ~~洗衣妇~~


## TODO 后续版本
+ 直接通过链接进入房间，不被允许
+ 玩家名字不允许重复，不能为空，长度
+ 标记玩家，自认他是什么，我认为他是什么
+ 游戏中时，退出游戏不允许再进入
+ 退出游戏后，主机转变
+ 人少不能开始游戏
+ 语音提示行为
+ 房间只存在5小时，超时后销毁
+ 加入房间，房间名称不能输入
+ 座位九宫格排列，用来表示邻座关系，单数最上面空着

